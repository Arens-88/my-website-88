let downloadOptimizer;async function loadDownloadOptimizer(){if(!downloadOptimizer)try{const e=await import('./download-optimizer.js');downloadOptimizer=e.downloadOptimizer}catch(e){console.warn('无法加载下载优化器，将使用传统下载方式:',e)}return downloadOptimizer}async function handleDownload(e){showNotification('准备下载安装程序，版本：'+e,'success');try{const t=await loadDownloadOptimizer();if(t)await t.startDownload('downloads/fba_installer.exe','fba_installer_'+e+'.exe');else{const t=document.createElement('a');t.href='downloads/fba_installer.exe',t.setAttribute('download','fba_installer_'+e+'.exe'),document.body.appendChild(t),t.click(),document.body.removeChild(t)}}catch(e){console.error('下载过程出错:',e),showNotification('下载失败，请重试','error')}}function showNotification(e,t='info'){const n=document.createElement('div');n.className='notification '+t,n.textContent=e,document.body.appendChild(n),setTimeout(()=>{n.remove()},3e3)}function updateVersionDisplay(e){const t=document.querySelector('.latest-version'),n=document.querySelector('.release-date'),o=document.querySelector('.version-description');t&&(t.textContent=e.latestVersion),n&&(n.textContent=e.releaseDate),o&&(o.textContent=e.description);const s=document.querySelectorAll('.version-info strong');s.forEach(t=>{t.parentNode.textContent.includes('当前版本')?t.nextSibling.textContent=' '+e.latestVersion:t.parentNode.textContent.includes('更新日期')&&(t.nextSibling.textContent=' '+e.releaseDate)})}function checkVersionInfo(){const e={latestVersion:'1.2.2',releaseDate:'2025-11-01',description:'修复了批量处理中的错误，移除了对不存在变量的引用，修正了异常处理结构，优化了代码稳定性，提高了程序运行效率'};updateVersionDisplay(e)}function setupButtonListeners(){const e=document.querySelectorAll('.btn');e.forEach(t=>{t.addEventListener('click',e=>{console.log('Button clicked:',this.textContent.trim()),t.classList.contains('download-btn')?handleDownload(t.dataset.version):t.textContent.includes('版本历史')?showNotification('正在跳转到版本历史页面...'):t.textContent.includes('查看更新信息')&&showNotification('正在加载更新信息...')}),t.addEventListener('mousedown',()=>{t.style.transform='translateY(1px)'}),t.addEventListener('mouseup',()=>{t.style.transform='translateY(-3px)'}),t.addEventListener('mouseleave',()=>{t.style.transform='translateY(0)'})})}function initPage(){setupButtonListeners(),checkVersionInfo(),enableSmoothScroll(),logVisitInfo(),setupFeatureCardEffects()}function enableSmoothScroll(){document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener('click',t=>{t.preventDefault();const n=document.querySelector(e.getAttribute('href'));n&&n.scrollIntoView({behavior:'smooth'})})})}function logVisitInfo(){const e=new Date,t={date:e.toISOString(),browser:navigator.userAgent,screen:`${window.screen.width}x${window.screen.height}`,language:navigator.language};console.log('Visit info:',t)}function animatePageElements(){const e=document.querySelectorAll('.feature-card');e.forEach((t,n)=>{setTimeout(()=>{t.style.opacity='1',t.style.transform='translateY(0)'},200*n)})}function setupFeatureCardEffects(){const e=document.querySelectorAll('.feature-card');e.forEach(t=>{t.addEventListener('mouseenter',function(){this.style.transform='scale(1.03)',this.style.boxShadow='0 10px 30px rgba(0, 0, 0, 0.15)'}),t.addEventListener('mouseleave',function(){this.style.transform='scale(1)',this.style.boxShadow='0 4px 15px rgba(0, 0, 0, 0.05)'})})}function checkResponsive(){const e=window.innerWidth;document.body.classList[e<768?'add':'remove']('mobile-view')}window.addEventListener('DOMContentLoaded',()=>{initPage(),animatePageElements()}),window.addEventListener('resize',()=>{checkResponsive()}),checkResponsive();